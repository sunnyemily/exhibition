<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>查看企业信息</title>
		<meta content="webkit" name="renderer">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
		<meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
		<link rel="stylesheet" href="/manage/css/xadmin.css">
		<link href="/manage/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/manage/layui/css/layui.css"  media="all">
		<link href="/manage/css/style.css?v=4.1.0" rel="stylesheet">
		<link href="/css/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.layui-form-pane .layui-form-label {
				width: 150px;
			}
			.layui-form-pane .layui-input-block {
				margin-left: 150px;
			}
			.layui-table, .layui-table-view{
				margin-top: 0px;
			}
			.textAreaDiv{
				border: 1px solid;
			    border-color: #e6e6e6!important;
			    min-height: 88px;
			    font-size: 14px;
			    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
			    color: black;
			    padding: 5px 10px;
			}
		</style>
	</head>
	<body class="gray-bg">
		<div class="modal inmodal" id="friendlink-model">
			<div class="modal-content animated bounceInUp" id="vmUpdateEbsCompanyinfo">
				<div class="ibox-content">
					<fieldset class="layui-elem-field layui-field-title" style="border-top:0px">
						<form class="layui-form layui-form-pane" action="">
							<div class="layui-form-item">
								<label class="layui-form-label"><span style='color:red'>*</span>用户名</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="memberUsername" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="engaddress"><span style='color:red'>*</span>统一社会信用代码</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block" id="organizationcodeDiv">
										<input readonly="readonly" class="layui-input" id="organizationcode" name="organizationcode" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="chinesename"><span style='color:red'>*</span>单位名称（中文）</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="chinesename" name="chinesename" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="engname"><span style='color:red'>*</span>单位名称（英文）</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="engname" name="engname" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="russianname">单位名称（俄文）</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="russianname" name="russianname" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="chineseaddress"><span style='color:red'>*</span>单位地址（中文）</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="chineseaddress" name="chineseaddress" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="engaddress"><span style='color:red'>*</span>单位地址（英文）</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="engaddress" name="engaddress" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="postcode"><span style='color:red'>*</span>邮编</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="postcode" name="postcode" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="phone"><span style='color:red'>*</span>手机</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="phone" name="phone" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="tel"><span style='color:red'>*</span>电话</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="tel" name="tel" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="fax"><span style='color:red'>*</span>传真</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="fax" name="fax" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="website">网址</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="website" name="website" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="email"><span style='color:red'>*</span>电子邮箱</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="email" name="email" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
	                            <label class="layui-form-label" for="country"><span style='color:red'>*</span>国家</label>
	                            <div class="layui-input-block">
	                                <div class="layui-input-inline layui-show-xs-block" id="countryDiv">
										<input readonly="readonly" class="layui-input" id="country" lay-verify="required" type="text">
		                            </div>
		                        </div>
		                    </div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="province"><span style='color:red'>*</span>省份</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block" id="provinceDiv">
										<input readonly="readonly" class="layui-input" id="province" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="city"><span style='color:red'>*</span>城市</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block" id="cityDiv">
										<input readonly="readonly" class="layui-input" id="city" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="principal"><span style='color:red'>*</span>负责人</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="principal" name="principal" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="contactperson"><span style='color:red'>*</span>联系人</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="contactperson" name="contactperson" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="jobtitle">联系人职务</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<input readonly="readonly" class="layui-input" id="jobtitle" name="jobtitle" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="industryid"><span style='color:red'>*</span>行业分类</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block" id="industryDiv">
										<input readonly="readonly" class="layui-input" id="industry" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" for="exhibitorsNatureId"><span style='color:red'>*</span>参展企业性质</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block" id="companyNatureDiv">
										<input readonly="readonly" class="layui-input" id="companyNature" lay-verify="required" type="text">
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="height: 100px;line-height: 70px;"><span style='color:red'>*</span>经营范围</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<div id="busscope" class="textAreaDiv"></div>
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="height: 100px;line-height: 70px;">希望结识客户</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<div id="hopecustomers" class="textAreaDiv"></div>
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="height: 100px;line-height: 70px;"><span style='color:red'>*</span>企业简介</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<div id="companyprofile" class="textAreaDiv"></div>
									</div>
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label" style="height: 100px;line-height: 70px;"><span style='color:red'>*</span>采购意向</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<div id="purchaseintention" class="textAreaDiv"></div>
									</div>
								</div>
							</div>		
							<div class="layui-form-item">
	                            <label class="layui-form-label" style="height: 51px;padding-top: 13px;" for="relateddocumentspath">参展人员</label>
	                            <div class="layui-input-block">
				                    <table id="test" lay-filter="test" style="margin-top: 0px;"></table>
		                        </div>
		                    </div>						
							<div class="layui-form-item">
								<div class="layui-input-block" id="confirmDiv">
									<button class="layui-btn layui-btn-primary" onclick="xadmin.close();" style="width: 100px;">
										返回
									</button>
								</div>
							</div>
						</form>
					</fieldset>
				</div>
			</div>
		</div>

		<script charset="utf-8" src="/manage/js/jquery.min.js" type="text/javascript"></script>
		<script charset="utf-8" src="/manage/layui/layui.js" type="text/javascript"></script>
		<script charset="utf-8" src="/manage/js/xadmin.js?v=" type="text/javascript"></script>		
		<script charset="utf-8" src="/manage/js/vue.js" type="text/javascript"></script>
		<script src="/manage/js/bootstrap.min.js?v=3.3.6"></script>
		<script src="/manage/js/manage/common.js"></script>
		<script src="/manage/js/content.js"></script>
		<script charset="UTF-8" type="text/javascript">
			var editEbsCompanyinfoId = sessionStorage.getItem("editEbsCompanyinfoId");
			
			
			function reloadTableDataCurrent() {				
				table.reload('test', {
					method : 'get',
					url : '/manage/Exhibitors/ebsPersonnelcard/getCGPersonnelCardList',
					where : {
						companyid: editEbsCompanyinfoId,
						"comanytypeid":5
					}
				});
			}
			var table;
			layui.use(['form', 'layer', 'laydate', 'upload', 'table'], function() {
				var layer = layui.layer;
				var form = layui.form;
				var upload = layui.upload;
				var laydate = layui.laydate;
				table = layui.table;
				vm = new Vue({
					el : "#vmUpdateEbsCompanyinfo",
					data : {
						ebsCompanyinfo : {}
					},
					created : function() {
						var _this = this;
						$.ajax({
							url : "/manage/Exhibitors/ebsScatteredExhibitorsManage/selectCompanyInfo",
							data : {
								"id" : editEbsCompanyinfoId
							},
							dataType : "json",
							type : "get",
							success : function(result) {
								if (result.code === 1) {
									$("#memberUsername").attr("value",result.data.memberUsername);
									$("#chinesename").attr("value",result.data.chinesename);
									$("#engname").attr("value",result.data.engname);
									$("#russianname").attr("value",result.data.russianname);
									$("#chineseaddress").attr("value",result.data.chineseaddress);
									$("#engaddress").attr("value",result.data.engaddress);
									$("#organizationcode").attr("value",result.data.organizationcode);
									$("#postcode").attr("value",result.data.postcode);
									$("#phone").attr("value",result.data.phone);
									$("#tel").attr("value",result.data.tel);
									$("#fax").attr("value",result.data.fax);
									$("#website").attr("value",result.data.website);
									$("#email").attr("value",result.data.email);
									$("#contactperson").attr("value",result.data.contactperson);
									$("#jobtitle").attr("value",result.data.jobtitle);
									$("#principal").attr("value",result.data.principal);
									$("#busscope").html(result.data.busscope);
									$("#hopecustomers").html(result.data.hopecustomers);
									$("#companyprofile").html(result.data.companyprofile);
									$("#purchaseintention").html(result.data.purchaseintention);
									
									loadCountry(result.data.country);
									loadProvince(result.data.country, result.data.province);
									loadCity(result.data.province, result.data.city);
									loadIndustry(result.data.industryid);
									loadCompanyNature(result.data.exhibitors_nature_id);
									
								} else {
									layer.alert("获取企业信息失败！");
								}
							}
						});
					}
				});
				
				table.render({
	        		elem: '#test'
	        		,url: '/manage/Exhibitors/ebsPersonnelcard/getCGPersonnelCardList'	
	        		,where:{
	        			companyid: editEbsCompanyinfoId,
						"comanytypeid":5
	        		}	
	        		,response: {
	        			statusCode: 1 
	        		}
	        		,width: document.documentElement.scrollWidth-190
	        		,even: true
	        		,page: true
	        		,toolbar: '#toolbarDemo'
	          		,defaultToolbar: []
	        		,cols: [[
	        			{type:'numbers', title:'序号'}
	        			,{align:'center', field: 'name', title: '姓名', width: 150}			
	        			,{align:'center', field: 'isback', title: '绿色通道', width: 90}
	        			,{align:'center', field: 'sex', title: '性别', width: 60}
	        			,{align:'center', field: 'status', title: '审核状态', width: 90}
	        			,{align:'center', field: 'companyname', title: '所属公司'}
	        			,{align:'center', field: 'remark', title: '未通过原因'}
	        			,{align:'center', field: 'addtime', title: '填报时间', width: 160, templet:'<div>{{ layui.util.toDateString(d.addtime) }}</div>'}
	        			,{fixed: 'right', align:'center', title: '操作', width: 120, templet:function (d) {
	        				var btn = '<a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>';
	        				if(d.status == null || d.status == '待审核' || d.status == '审核未通过'){
	        					btn += '<a class="layui-btn layui-btn-xs" lay-event="audit">审核</a>';
	        				}
	        				return btn;
	        			}}
	        		]]
	        		,done: function (res, curr, count) {
	        			/*var userPermissions = getUserPermissions();
	        			userPermissions.forEach(function (item, index) {
	        				if (item == 'Exhibitors/ebsScatteredExhibitorsBoothAuditController/batchAgainAudit'){
	        					$('#batchAgainAudit').removeClass("layui-hide");
	        				}
	        			});*/
	        		}
	        	});
				//监听工具条
				table.on('tool(test)', function(obj) {
					var data = obj.data;
					if (obj.event === 'audit') {
						sessionStorage.setItem("editEbsPersonnelcardId", data.id);
						xadmin.open('人员证件审核', '/manage/Exhibitors/EbsPersonnelcard/EbsPersonnelcardAudit.html');
					} else if (obj.event === 'edit') {
						sessionStorage.setItem("editEbsPersonnelcardId", data.id);
						xadmin.open('人员证件管理', '/manage/Exhibitors/EbsPersonnelcard/EbsPersonnelcardEdit.html');
					}
				});
				
				//加载国家
				window.loadCountry = function(selectCountry){
					var params = {};
					params.parentid='';
					$.ajax({
						url : "/common/GetCountry",
						data : JSON.stringify(params),
						type : "post",
						async: false, 
						contentType : "application/json",
						success : function(result) {
							if (result.code === 1) {
								for (var j = 0; j < result.data.length; j++) {
									if(selectCountry == result.data[j].id){
									    $("#country").attr("value",result.data[j].name);
									    return;
						    		}
								}
							} else {
								layer.alert(result.msg);
							}
						}
					});
				}
				//加载省份
				window.loadProvince = function(parentId, selectProvince) {
					$.get("/manage/system/sysCountryArea/loadProvince", {'parentId' : parentId}, function(r) {
						r.forEach(function(item, index) {
							if (selectProvince == item.id) {
								$("#province").attr("value",item.NAME);
								return;
							}
						});
					});
				}
				//加载城市
				window.loadCity = function(parentId, selectCity) {
					$.get("/manage/system/sysCountryArea/loadCity", {
						'parentId' : parentId
					}, function(r) {
						r.forEach(function(item, index) {
							if (selectCity == item.id) {
								$("#city").attr("value",item.NAME);
								return;
							}
						});
					});
				}
				//加载行业分类
				window.loadIndustry = function(selectIndustry) {
					$.get("/manage/system/sysIndustry/list", {
						'page' : 1,
						'limit' : 10000
					}, function(r) {
						if (r.code == 1) {
							r.data.forEach(function(item, index) {
								if (selectIndustry == item.id) {
									$("#industry").attr("value",item.chineseName);
									return;
								}
							});
						} else if (r.code == 5) {
							layer.confirm(r.msg, {
								icon : 3,
								title : '提示'
							}, function(index) {
								window.location.href = "/manage/login.html";
							});
						} else {
							layer.alert(r.msg);
						}
					});
				}
				//加载企业性质
				window.loadCompanyNature = function(selectcompanyNature) {
					$.get("/manage/system/sysCompanyType/list", {
						'page' : 1,
						'limit' : 10000
					}, function(r) {
						if (r.code == 1) {
							r.data.forEach(function(item, index) {
								if (selectcompanyNature == item.id) {
									$("#companyNature").attr("value",item.chineseName);
									return;
								}
							});
						} else if (r.code == 5) {
							layer.confirm(r.msg, {
								icon : 3,
								title : '提示'
							}, function(index) {
								window.location.href = "/manage/login.html";
							});
						} else {
							layer.alert(r.msg);
						}
					});
				}
			});
		</script>
		<script src="/manage/js/manage/crop.js"></script>
	</body>
</html>