<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>修改历届信息管理-代办员信息</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
    <link rel="stylesheet" href="/manage/css/xadmin.css">
	<link href="/manage/css/style.css?v=4.1.0" rel="stylesheet">
	<link href="/manage/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/manage/layui/css/layui.css"  media="all">
</head>
<body class="gray-bg">
    <div class="modal inmodal" id="friendlink-model">
		<div class="modal-content animated bounceInUp" id="vmUpdatePimAgent">
			<div class="ibox-content">
				<fieldset class="layui-elem-field layui-field-title" style="border-top:0px">
					<form class="layui-form layui-form-pane" lay-filter="test1" action="">
                        <table width="96%" style="margin:0px auto" border=0>
							<tr>
								<td colspan="2">
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="loginname" style="width:150px"><span style='color:red'>*</span>登录用户名</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:40%">
			                                    <input class="layui-input" autocomplete="off" lay-verify="required" readonly id="loginname" name="loginname" type="text" v-model="pimAgentx.loginname">
											</div>
										</div>
									</div>
								</td>								
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="loginpass" style="width:150px">登录密码</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="loginpass1" name="loginpass" type="password">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="loginpass" style="width:150px">确认密码</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" lay-verify="confirmPass" id="loginpassq" name="loginpassq" type="password">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="name" style="width:150px"><span style='color:red'>*</span>姓名</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" lay-verify="required" autocomplete="off" id="name" name="name" type="text" v-model="pimAgentx.name">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="sex" style="width:150px">性别</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
			                                    <input type="radio" value="0" id="sex1" title="男" name="sex">
												<input type="radio" value="1" name="sex" id="sex2" title="女">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td colspan="2" style="padding-bottom:10px" id="tdleixing">
									
								</td>
							</tr>
							<tr id="trjyt" style="display:none">
								<td colspan="2">
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="tradinggroupid" style="width:150px">所属交易团</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:40%">
			                                	<select id="tradinggroupid" name="tradinggroupid" class="layui-input">
			                                		
			                                	</select>
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="tradinggroupid" style="width:150px">代办员类型</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block radioborder" style="width:40%">
			                                	<input type="radio" value="0" id="type0" title="交易团" name="type">
												<input type="radio" value="1" name="type" id="type1" title="记者证">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="companyname" style="width:150px">所属单位（企业）</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="companyname" name="companyname" type="text" v-model="pimAgentx.companyname">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="tel" style="width:150px">电话</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="tel" name="tel" type="text" v-model="pimAgentx.tel">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="phone" style="width:150px">移动电话</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="phone" name="phone" type="text" v-model="pimAgentx.phone">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="jobtitle" style="width:150px">职务</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="jobtitle" name="jobtitle" type="text" v-model="pimAgentx.jobtitle">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="areaphone" style="width:150px">展区负责人手机</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block" style="width:80%">
			                                    <input class="layui-input" autocomplete="off" id="areaphone" name="areaphone" type="text" v-model="pimAgentx.areaphone">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="onsitecertification" style="width:150px">是否现场制证 </label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
			                                	<input type="radio" value="0" id="onsitecertification0" checked title="否" name="onsitecertification">
												<input type="radio" value="1" name="onsitecertification" id="onsitecertification1" title="是">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="makeevidence" style="width:150px">是否制证 </label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
			                                	<input type="radio" value="0" id="makeevidence0" checked title="否" name="makeevidence">
												<input type="radio" value="1" name="makeevidence" id="makeevidence1" title="是">
											</div>
										</div>
									</div>
								</td>
								<td>
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="uploadvehiclelicense" style="width:150px">上传车辆行驶证</label>
			                            <div class="layui-input-block">
			                                <div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
			                                	<input type="radio" value="0" id="uploadvehiclelicense0" checked title="否" name="uploadvehiclelicense">
												<input type="radio" value="1" name="uploadvehiclelicense" id="uploadvehiclelicense1" title="是">
											</div>
										</div>
									</div>
								</td>
							</tr>
							<tr>								
								<td colspan="1" valign="top">
									<div class="layui-form-item">
			                            <label class="layui-form-label" for="imagepath" style="width:150px">证件照片</label>
			                            <div class="layui-input-block" style="padding-top:1px;padding-left:3px;">	
			                            	<div class="layui-input-inline layui-show-xs-block" style="width:80%;padding-left:5px">		                                
			                                <input class="layui-input" autocomplete="off" id="imagepath" name="imagepath" type="hidden" v-model="pimAgentx.imagepath">											
												<div class="layui-input-inline">
										            <button type="button" class="layui-btn" id="uploadPictrue">
										              <i class="layui-icon">&#xe67c;</i>上传图片
										            </button>
										        </div>
										    </div>
										</div>
									</div> 
								</td>
								<td>
									<img src="/images/1.jpg" onclick="SeeImage(this.src)" width="390" id="imgzp" height="487">
								</td>
							</tr>
						</table>
						<div class="layui-form-item"> 
							<div class="layui-input-block">	               
								<button class="layui-btn" lay-filter="edit" lay-submit="">确认修改</button>
								<input type="hidden" id="txtcardtypes">
								<input type="hidden" id="txtsex">
								<input type="hidden" id="txtonsitecertification">
								<input type="hidden" id="txtmakeevidence">
								<input type="hidden" id="txtuploadvehiclelicense">
								<input type="hidden" id="txttradinggroupid">
								<input type="hidden" id="txttype">
								<input type="hidden" id="zhuangtai" value="0">
							</div>
						</div>
					</form>
 				</fieldset>
			</div>
		</div>
	</div>
	<script charset="utf-8" src="/manage/js/jquery.min.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/layui/layui.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/xadmin.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/vue.js" type="text/javascript"></script>
	<script src="/manage/js/bootstrap.min.js?v=3.3.6"></script>		
	<script src="/manage/js/manage/common.js"></script>		
	<script charset="UTF-8" type="text/javascript">
    	var editPimAgentId = sessionStorage.getItem("editPimAgentId");
    	vm = new Vue({
	        el: "#vmUpdatePimAgent",
	        data: {
	            pimAgent: {}
	        },
	        methods: {},
	        created: function () {
	            var _this = this;
	            $.ajax({
	                url: "/manage/PreviousInformation/pimAgent/findById",
	                data: {
	                    "id": editPimAgentId,
		                "session":''
	                },
	                dataType: "json",
	                type: "get",async:false,
	                success: function (result) {
	                    if (result.code === 1) {
	                        _this.pimAgent = result.data;
	                        _this.pimAgentx = JSON.parse( JSON.stringify(result.data) );
	                        
	                        $("#txtsex").val(result.data.sex);
	                        $("#txttype").val(result.data.type);
	                        $("#txtonsitecertification").val(result.data.onsitecertification);
	                        $("#txtmakeevidence").val(result.data.makeevidence);
	                        $("#txtuploadvehiclelicense").val(result.data.uploadvehiclelicense);
	                        $("#txtcardtypes").val(result.data.cardtypes);
	                        $("#txttradinggroupid").val(result.data.tradinggroupid);
	                        if(result.data.imagepath!=''){
	                        	$("#imgzp").attr("src",result.data.imagepath);
	                        }
	                    } else {
	                        layer.alert("获取修改历届信息管理-代办员信息信息失败！");
	                    }
	                }
	            });
	        }
	    });
    	layui.use(['form', 'layer', 'laydate'], function () {
            var form = layui.form, layer = layui.layer, laydate = layui.laydate;
            loadDaiBanYuanZhengJian(form,"tdleixing",$("#txtcardtypes").val(),'');
            loadTradingGroupByType(form,$("#txttradinggroupid").val(),'tradinggroupid');
            
            // 校验两次密码是否一致
			form.verify({
			    confirmPass:function(value){
			        if($('input[name=loginpass]').val() !== value)
			            return '两次密码输入不一致！';
			    },
			    password: [
			        /^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'
			    ]
			});
            
            var radio = document.getElementsByName("sex");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
			//console.log(radio[i].value);
				if ($("#txtsex").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}			
			var radio = document.getElementsByName("onsitecertification");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
				if ($("#txtonsitecertification").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}
			var radio = document.getElementsByName("makeevidence");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
				if ($("#txtmakeevidence").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}
			var radio = document.getElementsByName("uploadvehiclelicense");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
				if ($("#txtuploadvehiclelicense").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}
			
			var radio = document.getElementsByName("type");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
				if ($("#txttype").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}
			
			form.on('checkbox(canzhanzheng)', function(data){	
				if(data.elem.checked){
					$("#trjyt").show();
					$("#zhuangtai").val("1");
				}else{
					$("#trjyt").hide();
					$("#zhuangtai").val("0");
					$("#tradinggroupid").val('0');
					loadTradingGroupByType(form,'','tradinggroupid'); 
				}		
			});   
			
            form.render(null, 'test1');
            
            //监听提交
            form.on('submit(edit)', function (data) {
                //组装数据
                
                if($("#zhuangtai").val()=='1' && $("#tradinggroupid").val()==0){
                	layer.msg("请选择交易团", {icon: 5, time: 2000}, function () {});                    
                    return false;
                }
                if($("#zhuangtai").val()=='0'){
                	data.field.tradinggroupid=0;
                }
                
                data.field.id = editPimAgentId;
                var agentType="";
				var count=0;
                $(".chk").each(function(){
                	if($(this).is(':checked')) {
					    var typeid=$(this).attr("value");
					    var xh=$(this).attr("rel");
					    var shuliang=$("#txt"+xh).val();
					    if(count==0){
					    	agentType+=typeid+"|"+shuliang;
					    }
					    else{
					    	agentType+="@"+typeid+"|"+shuliang;
					    }
					    count++;
					}
                });         
                data.field.agenttype=agentType;
                //发异步，把数据提交给controller
                $.ajax({
                    url: "/manage/PreviousInformation/pimAgent/update",
                    data: JSON.stringify(data.field),
                    dataType: "json",
                    contentType: "application/json",
                    type: "post",
                    success: function (result) {
                        if (result.code === 1) {
                            layer.msg("修改成功", {icon: 6, time: 500}, function () {
                                //关闭当前frame
                                xadmin.close();
                                // 可以对父窗口进行刷新
                                xadmin.father_reload();
                            });
                        } else {
                            layer.alert(result.msg, {
								icon : 5
							});
                        }
                    }
                });
                return false;
            });
		});
		layui.use('upload', function(){
	  		var upload = layui.upload;	   	
	  		//上传图片
			var uploadPictrue = upload.render({
				accept:'images'
				,size:1024
				,exts:'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadPictrue' //绑定元素
				,url: '/manage/uploadPicture' //上传接
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#imagepath").val(res.result);
						$("#imgzp").attr("src",res.result);
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
					 layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  });  
			});
	</script>
</body>
</html>