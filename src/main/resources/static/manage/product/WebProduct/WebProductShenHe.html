<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>修改</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
    <link rel="stylesheet" href="/manage/css/xadmin.css">
	<link href="/manage/css/style.css?v=4.1.0" rel="stylesheet">
	<link href="/manage/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/manage/layui/css/layui.css"  media="all">
</head>
<body class="gray-bg">
    <div class="modal inmodal" id="friendlink-model">
		<div class="modal-content animated bounceInUp" id="vmUpdateWebProduct">
			<div class="ibox-content">
				<fieldset class="layui-elem-field layui-field-title" style="border-top:0px">
					<form class="layui-form layui-form-pane" lay-filter="test1" action="">
                        <div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="companyId">所属公司id</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                            		<input autocomplete="off" class="layui-input" id="companyId" name="companyId" lay-verify="required" type="text" v-model="webProduct.companyId">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="companyName">所属公司名称</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                					<input autocomplete="off" class="layui-input" readonly id="companyName" name="companyName" lay-verify="required" type="text" v-model="webProduct.companyName">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productMenuId">所属栏目</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                                	<select class="layui-input" id="productMenuId">
                                		
                                	</select>
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productName">产品名称</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                					<input autocomplete="off" class="layui-input" id="productName" name="productName" lay-verify="required" type="text" v-model="webProduct.productName">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productPrice">产品价格</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                                	<input autocomplete="off" class="layui-input" id="productPrice" name="productPrice" lay-verify="required" type="text" v-model="webProduct.productPrice">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productPicture">封面图</label>
                            <div class="layui-input-block">
                            	
                                <div class="layui-input-inline layui-show-xs-block ">
                					<input autocomplete="off" style="display:none" class="layui-input" id="productPicture" name="productPicture" lay-verify="required" type="text" v-model="webProduct.productPicture">
	                            </div>
	                            <div class="layui-input-inline radioborder" style="padding-left:5px">
											<button type="button" class="layui-btn" id="uploadPictrue1">
												<i class="layui-icon">&#xe67c;</i>上传图片
											</button>
											<button type="button" class="layui-btn layui-btn-primary" style="display:none" id="yulan1">
												预览
											</button>
										</div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productPictures">轮播图</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block radioborder" style="height:80px;border-left:1px solid #e8e8e8;border-bottom:1px solid #e8e8e8;border-right:1px solid #e8e8e8;border-top:1px solid #e8e8e8;border-radius: 0 2px 2px 0;">
                					<!--<input autocomplete="off" class="layui-input" id="productPictures" name="productPictures" lay-verify="required" type="text" v-model="webProduct.productPictures">-->
                					<table border=0>
                						<tr>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo1">
                								<button type="button" class="layui-btn" id="uploadLBPictrue1">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo1">
													预览
												</button>
                							</td>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo2">
                								<button type="button" class="layui-btn" id="uploadLBPictrue2">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo2">
													预览
												</button>
                							</td>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo3">
                								<button type="button" class="layui-btn" id="uploadLBPictrue3">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo3">
													预览
												</button>
                							</td>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo4">
                								<button type="button" class="layui-btn" id="uploadLBPictrue4">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo4">
													预览
												</button>
                							</td>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo5">
                								<button type="button" class="layui-btn" id="uploadLBPictrue5">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo5">
													预览
												</button>
                							</td>
                							<td align="center" valign="top" style="padding:0px 5px">
                								<input type="hidden" id="txtlunbo6">
                								<button type="button" class="layui-btn" id="uploadLBPictrue6">
												<i class="layui-icon">&#xe67c;</i>上传图片
												</button><br>
												<button type="button" style="display:none" style="margin-top:3px" class="layui-btn layui-btn-primary" id="lunbo6">
													预览
												</button>
                							</td>
                						</tr>
                					</table>
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productVideo">产品视频</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                					<input autocomplete="off" style="display:none" class="layui-input" id="productVideo" name="productVideo" type="text" v-model="webProduct.productVideo">
	                            </div>
	                            <div class="layui-input-inline radioborder" style="padding-left:5px">
											<button type="button" class="layui-btn" id="uploadPictrue2">
												<i class="layui-icon">&#xe67c;</i>上传视频
											</button>
											<button type="button" class="layui-btn layui-btn-primary" style="display:none" id="yulan2">
												预览
											</button>
										</div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productNum">款号</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                					<input autocomplete="off" class="layui-input" id="productNum" name="productNum" lay-verify="required" type="text" v-model="webProduct.productNum">
                					<input autocomplete="off" class="layui-input" id="productId" name="productId" lay-verify="required" type="hidden" v-model="webProduct.productId">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productOrder">排序</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                            		<input onkeyup="value=value.replace(/[^(\-)?\(0-9)+((0-9)))]/g,'')" autocomplete="off" class="layui-input" id="productOrder" name="productOrder" lay-verify="required" type="text" v-model="webProduct.productOrder">
	                            </div>
	                        </div>
	                    </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="productDescription">产品细节</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                 					<textarea id="productDescription" cols="20" rows="2" class="ckeditor"></textarea>
	                            </div>
	                        </div>
	                    </div>    
	                    <div class="layui-form-item">
                            <label class="layui-form-label" for="remark">审核拒绝理由</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block">
                 					<textarea class="layui-textarea" id="remark" name="remark" rows="4" v-model="webProduct.remark"></textarea>
	                            </div>
	                        </div>
	                    </div>   
	                    <div class="layui-form-item">
										<label class="layui-form-label" for="companyname" style="width:130px"><span style='color:red'>*</span>审核</label>
										<div class="layui-input-block">
											<div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
												<input type="radio" value="1" checked id="status1" title="审核通过" name="productStatus">
												<input type="radio" value="-1" name="productStatus" id="status-1" title="审核拒绝">
											</div>
										</div>
									</div>                   
			            <div class="layui-form-item">
				            <div class="layui-input-block">	
				            	<button class="layui-btn" lay-filter="edit" lay-submit="">确认修改</button>
				            	<input type="hidden" id="txtproductMenuId">
				            	<input type="hidden" id="txtproductStatus">
				            </div>
						</div>
					</form>
 				</fieldset>
			</div>
		</div>
	</div>
	<script charset="utf-8" src="/manage/js/jquery.min.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/layui/layui.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/xadmin.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/vue.js" type="text/javascript"></script>
	<script src="/manage/js/bootstrap.min.js?v=3.3.6"></script>	
	<script src="/manage/plugins/ckeditor/ckeditor.js" charset="utf-8"></script>	
	<script src="/manage/js/manage/common.js"></script>		
	<script charset="UTF-8" type="text/javascript">
		$(document).ready(function(){
			CKEDITOR.replace('productDescription');
		});
		
    	var editWebProductId = sessionStorage.getItem("editWebProductId");
    	vm = new Vue({
	        el: "#vmUpdateWebProduct",
	        data: {
	            webProduct: {}
	        },
	        methods: {},
	        created: function () {
	            var _this = this;
	            $.ajax({
	                url: "/manage/Product/webProduct/findById",
	                data: {
	                    "product_id": editWebProductId
	                },
	                dataType: "json",
	                type: "get",async:false,
	                success: function (result) {
	                    if (result.code === 1) {
	                        _this.webProduct = result.data;
	                        $('#productDescription').val(result.data.productDescription);
	                        CKEDITOR.instances.productDescription.setData($('#productDescription').val());
	                        $("#productMenuId").val(result.data.productMenuId);
	                        if(result.data.productPicture!=''){
	                        	$("#yulan1").show();
	                        	$("#yulan1").attr("onclick","window.open('"+result.data.productPicture+"')");
	                        }
	                        if(result.data.productVideo!=''){
	                        	$("#yulan2").show();
	                        	$("#yulan2").attr("onclick","window.open('"+result.data.productVideo+"')");
	                        }
	                        $("#txtproductStatus").val(result.data.productStatus);
	                        
	                        var productPictures = result.data.productPictures.replace("[","").replace("]","");
	                        if(productPictures!=''){
	                        	var strArgs = productPictures.split(',');
	                        	for(var j=0;j<strArgs.length;j++){
	                        		var imagepath=strArgs[j].replace('"','').replace('"','');
	                        		if(imagepath!=''){
		                        		$("#txtlunbo"+(j+1)).val(imagepath);
		                        		$("#lunbo"+(j+1)).attr("onclick","window.open('"+imagepath+"')");
		                        		$("#lunbo"+(j+1)).show();
		                        	}
	                        	}
	                        }
	                        
	                    } else {
	                        layer.alert("获取修改信息失败！");
	                    }
	                }
	            });
	        }
	    });
    	layui.use(['form', 'layer', 'laydate'], function () {
            var form = layui.form, layer = layui.layer, laydate = layui.laydate;
            
            loadZiDianByParentID_Select(form,$("#txtproductMenuId").val(),90,"productMenuId");
            
            var radio = document.getElementsByName("productStatus");
			var radioLength = radio.length;
			for (var i = 0; i < radioLength; i++) {
				if ($("#txtproductStatus").val() == radio[i].value) {
					$(radio[i]).next().click();
				}
			}
			
			form.render('', 'test1');
            
            //监听提交
            form.on('submit(edit)', function (data) {
                //组装数据
                data.field.id = editWebProductId;
                data.field.productDescription = CKEDITOR.instances.productDescription.getData();
                //console.log($("#remark").val());
                if(data.field.productStatus==-1 && $("#remark").val()==''){
                	layer.alert("请填写审核拒绝理由");
                	return false;
                }
                
                var imagepaths=new Array();
                var yb=0;
                for(var j=1;j<7;j++){
                	var imagepath = $("#txtlunbo"+j).val();
                	if(imagepath!=''){
                		imagepaths[yb]=imagepath;
                		yb++;
                	}
                }
                data.field.productPictures=JSON.stringify(imagepaths);
                //console.log(imagepaths);
                //return false;
                //发异步，把数据提交给controller
                $.ajax({
                    url: "/manage/Product/webProduct/update",
                    data: JSON.stringify(data.field),
                    dataType: "json",
                    contentType: "application/json",
                    type: "post",
                    success: function (result) {
                        if (result.code === 1) {
                            layer.msg("修改成功", {icon: 6, time: 500}, function () {
                                //关闭当前frame
                                xadmin.close();
                                // 可以对父窗口进行刷新
                                xadmin.father_reload();
                            });
                        } else {
                        	if(result.status==5){
                        		layer.alert(result.msg);
                        		parent.window.location.href='/manage/login.html';
                        	}
                            layer.alert(result.msg);
                        }
                    }
                });
                return false;
            });
		});
		
		layui.use('upload', function(){
	  		var upload = layui.upload;	   	
	  		//上传图片
			var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadPictrue1'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#productPicture").val(res.result);
						$("#yulan1").attr("onclick","window.open('"+res.result+"')");
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  });  
			  
			  //上传图片
			var uploadPictrue = upload.render({
				accept:'video'
				,size: 20480
				,exts:'mp4|flv'
				,elem: '#uploadPictrue2'
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#productVideo").val(res.result);
						$("#yulan2").attr("onclick","window.open('"+res.result+"')");
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
					 layer.msg(res.msg, {shift: 6});
				    }
				},
				error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  });		
			  
			  
			  
			//上传轮播图片
			var uploadPictrue = upload.render({
				accept:'video'
				,size: 20480
				,exts:'mp4|flv'
				,elem: '#uploadPictrue2'
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#productVideo").val(res.result);
						$("#yulan2").attr("onclick","window.open('"+res.result+"')");
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
					 layer.msg(res.msg, {shift: 6});
				    }
				},
				error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  });
			  
			  //上传轮播图
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue1'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo1").val(res.result);
						$("#lunbo1").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo1").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue2'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo2").val(res.result);
						$("#lunbo2").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo2").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue3'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo3").val(res.result);
						$("#lunbo3").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo3").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue4'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo4").val(res.result);
						$("#lunbo4").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo4").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue5'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo5").val(res.result);
						$("#lunbo5").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo5").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  var uploadPictrue = upload.render({
				accept:'images'
				,size: 2048
				,exts: 'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadLBPictrue6'
				,data: {width:750,height:422,size:2048}
				,url: '/updatePictureLimit'
				,before: function(obj){
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#txtlunbo6").val(res.result);
						$("#lunbo6").attr("onclick","window.open('"+res.result+"')");
						$("#lunbo6").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
						layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  }); 
			  
			  	  
			});
		
	</script>
</body>
</html>