<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>添加</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
    <link rel="stylesheet" href="/manage/css/xadmin.css">
	<link href="/manage/css/style.css?v=4.1.0" rel="stylesheet">
	<link href="/manage/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/manage/layui/css/layui.css"  media="all">
</head>
<body class="gray-bg">
    <div class="modal inmodal" id="friendlink-model">
		<div class="modal-content animated bounceInUp">
			<div class="ibox-content">
				<fieldset class="layui-elem-field layui-field-title" style="border-top:0px">
					<form class="layui-form layui-form-pane" action="">
                        <div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="parentid">活动日期</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divparentid">
                                	<input id="parentidx" name="parentidx" type="text" readonly class="layui-input" autocomplete="off">
                                	<input id="parentid" name="parentid" type="hidden" class="layui-input" autocomplete="off">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="starttime">开始时间</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divstarttime">
                                    <input lay-reqtext="开始时间为必填项" id="starttime" name="starttime" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="endtime">结束时间</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divendtime">
                                    <input id="endtime" name="endtime" placeholder="开馆、闭馆请保持结束时间为空" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="title">标题</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divtitle">
                                    <input lay-reqtext="为必填项" id="title" name="title" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="intro">介绍</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divintro">
                                    <input id="intro" name="intro" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="address">直播房间号</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divaddress">
                                    <input id="roomid" name="roomid" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label" for="siteHeadLogo"> 展示图片 </label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block radioborder" style="width:80%">
										<div class="layui-input-inline" style="width:100%;display:none">
							                <input id="acpicture" name="acpicture" readonly type="text" class="layui-input" >               
							              </div>
							              <div class="layui-input-inline" style="padding-left:5px">
							                <button type="button" class="layui-btn" id="uploadPictrue1">
							                  <i class="layui-icon">&#xe67c;</i>上传图片
							                </button>
							                <button type="button" class="layui-btn layui-btn-primary" style="display:none" id="yulanimg1">
							                  	预览
							                </button>
							              </div>										
									</div>
								</div>
							</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="address">地理位置</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divaddress">
                                    <input id="address" name="address" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="link">回放链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="link" name="link" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item">
                            <label class="layui-form-label" for="link">直播链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="liveaddress" name="liveaddress" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item">
                            <label class="layui-form-label" for="link">RTMP链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="videortmp" name="videortmp" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="link">FLV链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="videoflv" name="videoflv" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="link">HLS链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="videohls" name="videohls" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<div class="layui-form-item" style="display:none">
                            <label class="layui-form-label" for="link">UDP链接</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divlink">
                                    <input id="videoudp" name="videoudp" type="text" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" for="orders">排序</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divorders">
                                	<input lay-verify="required" value="99" lay-reqtext="排序为必填项" id="orders" name="orders" type="text" class="layui-input" autocomplete="off">
								</div>
							</div>
						</div>
						<div class="layui-form-item">
                            <label class="layui-form-label" for="status">类型</label>
                            <div class="layui-input-block">
                                <div class="layui-input-inline layui-show-xs-block" id="Divstatus">
                                	<input type='radio' name='zhuangtai' id="zhuangtai0" value='0' checked title='线上'>
									<input type='radio' name='zhuangtai' id="zhuangtai1" value='1' title='线下'>									
								</div>
							</div>
						</div>
						<div class="layui-form-item">
								<label class="layui-form-label" for="productDescription">内容</label>
								<div class="layui-input-block">
									<div class="layui-input-inline layui-show-xs-block">
										<textarea id="content" name="content" cols="20" rows="2" class="ckeditor"></textarea>
									</div>
								</div>
							</div>
						<div class="layui-form-item"> 
							<div class="layui-input-block">	               
								<button class="layui-btn" lay-filter="add" lay-submit="">确认添加</button>
							</div>
						</div>
					</form>
				</fieldset>
			</div>
		</div>
	</div>
	<script charset="utf-8" src="/manage/js/jquery.min.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/layui/layui.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/xadmin.js" type="text/javascript"></script>
	<script charset="utf-8" src="/manage/js/vue.js" type="text/javascript"></script>
	<script src="/manage/js/bootstrap.min.js?v=3.3.6"></script>
	<script src="/manage/plugins/ckeditor/ckeditor.js" charset="utf-8"></script>
	<script src="/manage/js/manage/common.js"></script>		
	<script charset="UTF-8" type="text/javascript">
	var myeditor;
	$(document).ready(function() {
		myeditor=CKEDITOR.replace('content');
	});
	var addOnlineActivityDetailsId = sessionStorage.getItem("addOnlineActivityDetailsId");
	var addOnlineActivityDetailsDate = sessionStorage.getItem("addOnlineActivityDetailsDate");
	$("#parentidx").val(addOnlineActivityDetailsDate);
	$("#parentid").val(addOnlineActivityDetailsId);
	
    	layui.use(['form', 'layer', 'laydate'], function () {
            var form = layui.form, layer = layui.layer;
            var laydate = layui.laydate;
            laydate.render({
					elem : '#starttime', //指定元素
					min: 0,					
					type:'time',
					format : 'HH:mm',
					theme : 'molv'
				});
            
            laydate.render({
					elem : '#endtime', //指定元素
					min: 0,					
					type:'time',
					format : 'HH:mm',
					theme : 'molv'
				});
            
            
            //监听提交
            form.on('submit(add)', function (data) {   
                //发异步，把数据提交给java
                data.field.content = myeditor.document.getBody().getHtml();
                $.ajax({
                    url: "/manage/online/onlineActivityDetails/save",
                    data: JSON.stringify(data.field),
                    dataType: "json",
                    type: "post",
                    contentType: "application/json",
                    success: function (result) {
                        if (result.code === 1) {
                            layer.msg("增加成功", {icon: 6, time: 500}, function () {
                                //关闭当前frame
                                xadmin.close();
                                // 可以对父窗口进行刷新
                                xadmin.father_reload();
                            });
                        } else {
                            layer.alert(result.msg);
                        }
                    }
                });
				return false;
			});
		});
		
		layui.use('upload', function(){
	  		var upload = layui.upload;
	   		
	  		//上传图片
			var uploadPictrue = upload.render({				
				accept:'images'
				,size:1024
				,exts:'jpg|jpeg|png|gif|bmp'
				,elem: '#uploadPictrue1' //绑定元素
				,url: '/manage/uploadPicture' //上传接
				,before: function(obj){
					/*if($("#exhibitionid").val()==''){
			   			layer.msg('请先选择展会', {icon: 2});
			   			return false;
			   		}*/
					layer.load(); //上传loading
				}
				,done: function(res){
					layer.closeAll('loading');
					if(res.status==1){
						$("#acpicture").val(res.result);
						$("#yulanimg1").attr("onclick","window.open('"+res.result+"')");
						$("#yulanimg1").show();
						layer.msg('上传成功', {icon: 6});
					}				
				    else{
					 layer.msg(res.msg, {shift: 6});
				    }
				}
				,error: function(){
				  //请求异常回调
				  	layer.msg('接口异常', {shift: 6});
					layer.closeAll('loading');
				}
			  });  
			});
	</script>
</body>
</html>